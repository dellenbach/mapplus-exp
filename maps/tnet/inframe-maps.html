<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <title>Karten</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="inframe-maps.css?v=20260122-reset">
  <style>
    html, body { height: 100%; margin: 0; padding: 0; overflow: hidden; }
    #mapFrame {
      width: 100%;
      height: 100%;
      border: none;
      display: block;
    }
    #loadingMessage {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 18px;
      color: #666;
    }
  </style>
</head>
<body>
  <div id="loadingMessage">Wird geladen...</div>
  <script src="tnet-mapplus-helpers.js"></script>
  
  <!-- Sichtbares Karten-iframe -->
  <iframe id="mapFrame" src="" style="visibility:hidden;"></iframe>
  
  <script>
    // =============================================================
    // KONFIGURATION - Version 20260122-v7
    // Pre-Login passiert in index_de.htm - hier nur noch laden
    // =============================================================
    
    function log(msg) {
      console.log('[inframe] ' + msg);
    }
    
    function getGroup() {
      var url = '';
      try { url = window.top.location.href; } catch(e) {
        try { url = window.parent.location.href; } catch(e2) {
          url = window.location.href;
        }
      }
      var match = url.match(/[?&]group=([^&]+)/);
      return match ? decodeURIComponent(match[1]) : 'none';
    }
    
    function getMapType() {
      var group = getGroup().toLowerCase();
      if (group.indexOf('ow') === 0) return 'ow';
      return 'nw';
    }
    
    function showFrame() {
      var f = document.getElementById('mapFrame');
      var l = document.getElementById('loadingMessage');
      if (f) { f.style.visibility = 'visible'; f.style.opacity = '1'; }
      if (l) l.style.display = 'none';
    }
    
    function buildIframeSrc(group) {
      var mapType = getMapType();
      return '/maps/active-maps-' + mapType + '?group=' + encodeURIComponent(group);
    }
    
    // =============================================================
    // HAUPTLOGIK - EINFACH
    // Pre-Login passiert bereits in index_de.htm
    // =============================================================
    var mapFrame = document.getElementById('mapFrame');
    var group = getGroup();
    var mapType = getMapType();
    
    log('=== INIT (Version 20260122-v7) ===');
    log('Group: ' + group);
    log('MapType: ' + mapType);
    log('Pre-Login sollte bereits in index_de.htm gestartet sein');
    
    mapFrame.src = buildIframeSrc(group);
    mapFrame.onload = function() {
      log('iframe geladen');
      showFrame();
    };
    
    // DEBUG
    window.reloadMap = function() {
      mapFrame.src = buildIframeSrc(group) + '&_t=' + Date.now();
    };
  </script>
</body>
</html>
