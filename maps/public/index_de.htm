<!DOCTYPE HTML>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
    <link rel="preconnect" href="https://www.gis-daten.ch" crossorigin>
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
    <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
    <link rel="dns-prefetch" href="//www.gis-daten.ch">
    <link rel="dns-prefetch" href="//cdn.jsdelivr.net">
    <link rel="dns-prefetch" href="//cdnjs.cloudflare.com">
    <title>MAP+ GIS Daten AG</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@v10.6.0/ol.css"
        onerror="this.href='/mapplus-lib/openlayers/v10.6.0-package/ol.css';">

    <!--
	Layout CSS linking a template and custom layout: to be integrated
  -->
    <link rel="stylesheet" type="text/css"
        href="/mapplus-lib/dojo-release/dojo-release-1.17.3/dijit/themes/tundra/tundra.css" />
    <link rel="stylesheet" type="text/css"
        href="/mapplus-lib/dojo-release/dojo-release-1.17.3/dojox/widget/ColorPicker/ColorPicker.css" />
    <link rel="shortcut icon" href="favicon.png?" />
    <!-- google fonts - Roboto als Hauptschrift -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <!--
	Layout CSS dojo FloatingPane module
  -->
    <link rel="stylesheet" href="../core/templates/nwow_floating/css/FloatingPane.css" />
    
    <!--
	Layout CSS dojo Dialog module
  -->
    <link rel="stylesheet" href="../core/templates/nwow_floating/css/Dialog.css" />
    <!--
	Layout CSS Disclaimer module
  -->
    <link rel="stylesheet" href="../core/templates/nwow_floating/css/Disclaimer.css" />
    <!--
	Layout CSS dojo checkboxtree module
  -->
    <link rel="stylesheet" href="../core/templates/nwow_floating/css/InfoWindow.css" />
    <!--
	POI Manager CSS for icons
  -->
    <link rel="stylesheet" href="../core/templates/nwow_floating/css/PoiManager.css" />
    <!--
	Layout CSS classic Layermanager module
  -->
    <link rel="stylesheet" href="../core/templates/nwow_floating/css/ClassicLayerMgr.css" />
    <!--
	ScaleBar CSS
  -->
    <link rel="stylesheet" type="text/css" href="../core/templates/nwow_floating/css/style.css" />
    <!--
	Layout CSS for search params grids
  -->
    <style type="text/css">
        @import "../core/templates/nwow_floating/css/tundraGrid.css";
        @import "/mapplus-lib/dojo-release/dojo-release-1.17.3/dojox/grid/enhanced/resources/tundra/EnhancedGrid.css";
        @import "/mapplus-lib/dojo-release/dojo-release-1.17.3/dojox/grid/enhanced/resources/EnhancedGrid_rtl.css";
    </style>

    <!-- load this javascript before dojo to avoid multidefine error -->
    <!-- jspdf for preview-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- filesaver-js -->
    <script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.12.1/proj4.min.js" crossorigin="anonymous"
        referrerpolicy="no-referrer"></script>
    <script>window.proj4 || document.write('<script src="/mapplus-lib/proj4js/2.12.1/dist/proj4.js">\x3C/script>')</script>
    <script src="//cdn.jsdelivr.net/npm/ol@v10.6.0/dist/ol.js"></script>
    <script>window.ol || document.write('<script src="/mapplus-lib/openlayers/v10.6.0-package/dist/ol.js">\x3C/script>')</script>

    <script type="text/javascript">

        var dojoConfig = {
            parseOnLoad: false,
            isDebug: false,
            baseUrl: "",
            async: true,
            packages: [{
                name: "njs",
                location: "/mapplus-lib/mapplus-dojo/v4.0.0/extended"
            }],
            locale: "de"
        };

        var hideLoader = function () {
            dojo.fadeOut({
                node: "preloader",
                onEnd: function () {
                    dojo.style("preloader", "display", "none");
                }
            }).play();
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
    <script>window.Sortable || document.write('<script src="/mapplus-lib/Sortable/1.15.0/Sortable.min.js">\x3C/script>')</script>
    <script
        data-dojo-config="packages:[{name:'dojo',location:'https://cdnjs.cloudflare.com/ajax/libs/dojo/1.17.3'},{name:'dijit',location:'/mapplus-lib/dojo-release/dojo-release-1.17.3/dijit'},{name:'dojox',location:'/mapplus-lib/dojo-release/dojo-release-1.17.3/dojox'}]"
        data-dojo-config="mblAlwaysHideAddressBar: true"
        src="https://cdnjs.cloudflare.com/ajax/libs/dojo/1.17.3/dojo.js"></script>
    <script>window.define || document.write('<script data-dojo-config= \'packages:[{name:"dojo",location:"/mapplus-lib/dojo-release/dojo-release-1.17.3/dojo"},{name:"dijit",location:"/mapplus-lib/dojo-release/dojo-release-1.17.3/dijit"},{name:"dojox",location:"/mapplus-lib/dojo-release/dojo-release-1.17.3/dojox"}],mblAlwaysHideAddressBar:true\' src="/mapplus-lib/dojo-release/dojo-release-1.17.3/dojo/dojo.js">\x3C/script>')</script>

    <link rel="stylesheet" href="public/css/override.css" />
    <script>
        var isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);
        if ((navigator.userAgent.indexOf("iPad") > -1) || (navigator.platform.indexOf('Mac') > -1)) {
            console.log(navigator.userAgent);
            var ipadCss = document.createElement("link");
            ipadCss.type = "text/css";
            ipadCss.rel = "stylesheet";
            ipadCss.href = "../core/templates/nwow_floating/css/style_ipad.css";
            document.head.appendChild(ipadCss);
        } 
    </script>

</head>

<body class="tundra">
    <!-- Preloader mit Critical Inline CSS für sofortige Anzeige -->
    <style>
      #preloader{position:fixed;top:0;left:0;right:0;bottom:0;width:100%;height:100%;background:rgba(255,255,255,0.95);background-image:none!important;display:flex;align-items:center;justify-content:center;z-index:99999;perspective:200px}
      #preloader .preloader-cube{width:32px;height:32px;position:relative;transform-style:preserve-3d;transform:rotateX(-30deg) rotateY(-30deg);animation:pRotate 1s infinite linear;will-change:transform;backface-visibility:hidden}
      #preloader .preloader-cube .cube-face{position:absolute;width:32px;height:32px;backface-visibility:hidden}
      #preloader .preloader-cube .cube-front{transform:rotateY(0deg) translateZ(16px);background:#f00}
      #preloader .preloader-cube .cube-back{transform:rotateY(180deg) translateZ(16px);background:#8a0000}
      #preloader .preloader-cube .cube-left{transform:rotateY(-90deg) translateZ(16px);background:#8a0000}
      #preloader .preloader-cube .cube-right{transform:rotateY(90deg) translateZ(16px);background:#ffe4e4}
      #preloader .preloader-cube .cube-top{transform:rotateX(90deg) translateZ(16px);background:#f69f9f}
      #preloader .preloader-cube .cube-bottom{transform:rotateX(-90deg) translateZ(16px);background:#8a0000}
      @keyframes pRotate{from{transform:rotateX(-30deg) rotateY(0deg)}to{transform:rotateX(-30deg) rotateY(360deg)}}
    </style>
    <div id="preloader">
      <div class="preloader-cube"><div class="cube-face cube-front"></div><div class="cube-face cube-back"></div><div class="cube-face cube-left"></div><div class="cube-face cube-right"></div><div class="cube-face cube-top"></div><div class="cube-face cube-bottom"></div></div>
    </div>
    <!-- begin modules load: must be done here in body-->

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol-ext/dist/ol-ext.min.css"
        onerror="this.href='mapplus-lib/openlayers/ol-ext/dist/ol-ext.min.css';">
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/ol-ext/dist/ol-ext.min.js"></script>
    <script>window.ol.ext || document.write('<script src="/mapplus-lib/openlayers/ol-ext/dist/ol-ext.min.js">\x3C/script>')</script>

    <script type="text/javascript" src="/mapplus-lib/mapplus-dojo/v4.0.0/common.js"></script>
    <script type="text/javascript" src="/mapplus-lib/mapplus-dojo/v4.0.0/njs.js"></script>
    <script type="text/javascript" src="/mapplus-lib/mapplus-dojo/v4.0.0/layout.js"></script>
    <script type="text/javascript" src="/mapplus-lib/mapplus-dojo/v4.0.0/appmanager.js"></script>
    <script type="text/javascript" src="/mapplus-lib/mapplus-dojo/v4.0.0/search.js"></script>
    <!--     <script type="text/javascript" src="/mapplus-lib/mapplus-dojo/v4.0.0/floatingwindow.js"></script>-->
    <script type="text/javascript" src="/mapplus-lib/mapplus-dojo/v4.0.0/provider/OLPlus/openlayers.js"></script>

    <script type="text/javascript">
        /* Application configuration */
        njs.AppManager.Version = "v4.0.0";
        njs.AppManager.apipath = "/mapplus-lib/mapplus-dojo/";
        njs.AppManager.Provider = "OLPlus";
        njs.AppManager.template = "nwow_floating";
        njs.AppManager.keepalivetimeout = 180000; // millisecs
        njs.AppManager.keepalivepage = "/mapplus-lib/mapplus-dojo/v4.0.0/php/sso/keepalive.php"
    </script>
    <?php print $set_vars?>


    <!-- dojo modules and startup config-->
    <script type="text/javascript" src="public/config/modules.js?v=v4.0.0"></script>
    <!-- end modules load -->


    <div id="disclaimer_copyright" class="njsDisclaimer"></div>
    <!-- TYDAC Disclaimer entfernt -->
    <div id="disclaimer_tips" class="njsDisclaimer"></div>
    <div id="disclaimer_news" class="njsDisclaimer"></div>
    <div id="disclaimer_pdf" class="njsDisclaimer" style='visibility:hidden'></div>

    <!-- Modaler Dialog mit iframe - ohne Rahmen, abgedunkelter Hintergrund -->
    <div id="mapsInfoDialog" data-dojo-type="dijit/Dialog" title="">
        <div class="customRefreshBtn" onclick="refreshIframe()" title="Seite neu laden">↻</div>
        <div class="customBackBtn" onclick="goBackInIframe()">‹</div>
        <div class="customCloseBtn" onclick="closeMapsInfoDialog()">×</div>
        <iframe id="mapsInfoFrame" name="mapsInfoFrame" data-src="/maps/tnet/inframe-maps.html" 
            loading="lazy" sandbox="allow-same-origin allow-scripts" referrerpolicy="no-referrer"
            style="width: 100%; height: 100%; border: none;"></iframe>
    </div>


    
    <!-- GIS Header-Leiste -->
    <div id="gis_logo_header"></div>
    
    <!-- Header Toolbar rechts oben -->
    <div id="header_toolbar">
        <!-- Anmelde-Button (nicht angemeldet) -->
        <div id="header_login" title="Anmelden" onclick="window.location.href=window.location.href+'&amp;group=?'">
            <span class="login-text">Anmelden</span>
            <svg class="login-arrow" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
        </div>
        <!-- Abmelde-Bereich (angemeldet) -->
        <div id="header_logout" style="display: none;" title="Abmelden" onclick="doLogout()">
            <svg class="user-icon" viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
            <span id="header_username" class="username-text"></span>
            <span class="separator">|</span>
            <span class="logout-text">Abmelden</span>
            <svg class="logout-arrow" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
        </div>
        <!-- News (Glocke) -->
        <div class="toolbar-item" title="News" onclick="window.open('https://www.gis-daten.ch/news-termine/news/', '_blank')">
            <svg viewBox="0 0 24 24"><path d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.9 2 2 2zm6-6v-5c0-3.07-1.63-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.64 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2zm-2 1H8v-6c0-2.48 1.51-4.5 4-4.5s4 2.02 4 4.5v6z"/></svg>
        </div>
        <!-- Support (Mail) -->
        <div class="toolbar-item" title="Support kontaktieren" onclick="window.open('https://www.gis-daten.ch/ueber-uns/support/', '_blank')">
            <svg viewBox="0 0 24 24"><path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/></svg>
        </div>
        <!-- Menü -->
        <div class="toolbar-item" title="Menü">
            <svg viewBox="0 0 24 24"><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>
        </div>
    </div>
    
    <!-- Kartenauswahl Button links oben -->
    <div id="header_maps_select" onclick="openMapsInfoDialog()" title="Kartenauswahl öffnen">
        <span class="maps-icon"><img src="/maps/tnet/resources/icon-maps.svg" alt=""></span>
        <span class="maps-text">Karten</span>
    </div>
    
    <!-- Suchfeld im Header (fixed positioniert) -->
    <div id="njs_search_wrapper"></div>
    
    <!-- GIS Logo links oben (SVG + drehender Würfel) -->
    <a id="gis_logo_container" href="https://www.gis-daten.ch" target="_blank" title="GIS Daten AG - Nidwalden Obwalden">
        <img class="gis-logo-svg" src="/maps/tnet/resources/logo_gis.svg" alt="GIS Daten AG">
        <img class="gis-logo-cube" src="/maps/tnet/resources/gis-cube.gif" alt="">
    </a>

    <div id="freepane" style="position: absolute;left:20px;top:20px;z-index: 50;width:340px;">
        <!-- <div id="lselector">
            <select id="langselect" onchange="changemappluslang(this.options[this.selectedIndex].value);">
                <option value="de" selected>de</option>
                <option value="en">en</option>
                <option value="fr">fr</option>
                <option value="it">it</option>
            </select>
        </div> -->
        <div id="leftPaneHeader" class="njsFooter">
            <div id="logoMapPlus"></div>
        </div>


        <div id="spring">
            <!-- ÜBERGEORDNETES MENU -->
            <div id="tp_overview_menu" data-dojo-type="dijit/TitlePane"
                data-dojo-props="title: 'Themenkatalog', open:false" style="padding:0px;margin:0px;">

                <!-- LAYERMANAGER MENU - wird per JS zu Tabs konvertiert -->
                <div id="kantons_container">
                    <div id="tp_layer_menu" data-dojo-type="dijit/TitlePane" data-dojo-props="title: 'Nidwalden', open:false"
                        style="padding:0px;margin:0px;">
                        <div id="layer_menu" data-dojo-type="dijit.layout.ContentPane" title="Titel 1">
                            <div id="njs_main_lyrmgr_wrapper" style="width: 100%;">
                            </div>
                        </div>
                    </div>
                    
                    <div id="tp_layer_menu2" data-dojo-type="dijit/TitlePane" data-dojo-props="title: 'Obwalden', open:false"
                        style="padding:0px;margin:0px;">
                        <div id="layer_menu2" data-dojo-type="dijit.layout.ContentPane" title="Titel 2">
                            <div id="njs_second_lyrmgr_wrapper" style="width: 100%;">
                            </div>
                        </div>
                    </div>
                    <div id="tp_layer_menu3" data-dojo-type="dijit/TitlePane" data-dojo-props="title: 'Bund', open:false"
                        style="padding:0px;margin:0px;">
                        <div id="layer_menu3" data-dojo-type="dijit.layout.ContentPane" title="Titel 3">
                            <div id="njs_third_lyrmgr_wrapper" style="width: 100%;">
                            </div>
                        </div>
                    </div>
                    <div id="tp_layer_menu4" data-dojo-type="dijit/TitlePane" data-dojo-props="title: 'Weitere', open:false"
                        style="padding:0px;margin:0px;">
                        <div id="layer_menu4" data-dojo-type="dijit.layout.ContentPane" title="Titel 4">
                            <div id="njs_forth_lyrmgr_wrapper" style="width: 100%;">
                            </div>
                        </div>
                    </div>
                </div>
            </div>


            <!-- LAYERMANAGER WMS -->
            <div id="tp_wms_menu" data-dojo-type="dijit/TitlePane"
                data-dojo-props="title: 'Externe Kartendienste (WMS)', open:false">
                <div id="wms_menu" dojotype="dijit.layout.ContentPane" title="Externe Kartendienste">
                    <div id="njs_wmsimport_dialog" style="width:100%; height:100%;"></div>
                </div>
            </div>
            <!-- LAYERMANAGER SORT LAYERS -->
            <div id="tp_sort_menu" data-dojo-type="dijit/TitlePane"
                data-dojo-props="title: 'Dargestellte Themen', open:false">
                <div id="sort_menu">
                    <div id="njs_main_lyrsorter_wrapper" style="width: 100%; height:100%; border:0">
                        <div id="main_lyrsorter_txt" style="display:block;text-align: center;">--- Keine Daten
                            ausgewählt ---</div>
                        <ul id="main_lyrsorter" style="list-style-type: none; padding: 0;"></ul>
                    </div>
                </div>
            </div>
            <!-- TOOL MENU -->
            <div id="tp_tools_menu" data-dojo-type="dijit/TitlePane"
                data-dojo-props="title: 'Werkzeuge / Export', open:false">
                <div id="tools_menu">
                    <div id="njs_measure_wrapper"></div>
                    <div id="njs_redlining_wrapper"></div>
                </div>
                <div id="preview_menu" data-dojo-type="dijit/TitlePane"
                    data-dojo-props="title: 'Export PDF / PNG', open:true">
                    <span style="width:100%;text-align:center;display:block;">
                        <button id="btn_htmlprint1_preview"
                            class="dijitReset dijitInline dijitButtonNode dijitButtonExport"
                            style="text-align: center;box-shadow: 0px 1px 2px #999;margin-right: 10px !important;height: 24px !important;min-width:97px">
                            <span class="njsIconButtonVorExport"
                                style="width:18px;height:18px;display:inline-block"></span>
                            <span>Export</span>
                        </button>

                    </span>
                </div>
            </div>

            <!-- PRINT MENU -->
            <div id="tp_print_menu" data-dojo-type="dijit/TitlePane" data-dojo-props="title: 'Drucken', open:false">

                <div id="print_menu" data-dojo-type="dijit/TitlePane"
                    data-dojo-props="title: 'Ausdruck massstäblich', open:true">
                    <div id="njs_print_wrapper" style="width: 100%; height:100%; border:0"></div>
                </div>


            </div>

            <!-- OVERVIEW -->
            <div id="tp_ov_menu" data-dojo-type="dijit/TitlePane" data-dojo-props="title: 'Navigieren', open:false">
                <div id="ovWin"
                    style="border:solid 1px #424A52; display:block; position:relative; right:-1px; bottom:-1px; z-Index:998; width:310px;height:240px;">
                </div>
            </div>

            <!-- FooterPane for coords-->
            <div id="footPane_main" class="edgePanel" data-dojo-type="dijit.layout.ContentPane"
                data-dojo-props="region: 'bottom'" style="background: #ffffff;">
                <div id="footPane" class="edgePanel" data-dojo-type="dijit.layout.ContentPane"
                    data-dojo-props="region: 'bottom'">
                    <div id="leftPaneFooter" class="njsFooter">
                        <div id="njs_coordinates_wrapper"></div>
                    </div>
                </div> <!-- End FooterPane for coords-->
            </div>
            
            <!-- Panel Zuklapp-Button -->
            <div class="close_switch" title="Panel ein-/ausklappen" onclick="document.getElementById('freepane').classList.toggle('close');"></div>
        </div>

        <!-- Scroll-to-Top Button (Chevron wird via CSS generiert) -->
        <button id="scrollToTopBtn" onclick="scrollSpringToTop()" title="Nach oben"></button>

    </div>





    <div id="NeapoljsContainer" dojotype="dijit.layout.BorderContainer" design="headline" gutters="false"
        style="width:100%; height:100%;">


        <div id="centerPane" class="edgePanel" data-dojo-type="dijit.layout.ContentPane"
            data-dojo-props="region: 'center'">
            <div id="centerPaneLayout" class="demoLayout" data-dojo-type="dijit.layout.BorderContainer"
                data-dojo-props="design: 'headline'" style="margin: 0px;padding: 0px;border: none">
                <div dojotype="dijit.layout.ContentPane" id='mapContainer' region="center" style="overflow:hidden;">
                    <div id="popup" class="ol-popup">
                        <a href="#" id="popup-closer" class="ol-popup-closer"></a>
                        <div id="popup-content"></div>
                    </div>

                    <div id="njs_main_shop_wrapper" style="display:none"></div>
                    <div id="map" class="map-cont" style="height:100%;"></div>
                    <div id="mainButtonBar"></div>
                    <div id='scale-line' style="position:absolute; left:10px; bottom:30px; z-Index:999;"></div>
                    <div id='mapcontrols_div' style="z-index:99999;">
                        <div id='toggle_coltool1_div' style="visibility: hidden;">
                            <input type="button" class="toggle_coltool" id="btnBW"
                                onclick="njs.AppManager.toggleBaseLayerColor('main','toggle_coltool1',this);">
                        </div>
                        <div style="width: 3px;"></div>
                        <div id='opacitytool1_rangediv' style="height:20px; visibility: hidden; width: 110px;">
                            <input type='range' min='0' max='100' value='0'
                                style="width: 110px; margin-top: -1px !important;" id='opacitytool1_range'
                                oninput="njs.AppManager.setBaseLayerOpacity('main',this.value);"
                                onchange="njs.AppManager.setBaseLayerOpacity('main',this.value);">
                        </div>
                    </div>
                    <!-- <div id="ovWin" style="border:solid 1px #424A52; display:none; position:absolute; right:-1px; bottom:-1px; z-Index:998; width:240px;height:240px;">
                        <div id="overviewDiv" style="width:100%;height:100%;"></div>
                    </div>
                    <div id="ovToggleImg" onClick="njs.Layout.toggle_visibility('ovWin');njs.Layout.toggle_img('ovImg','../core/templates/nwow_floating/img/arrow_tl.png','../core/templates/nwow_floating/img/arrow_br.png')">
                        <img id="ovImg" src="../core/templates/nwow_floating/img/arrow_tl.png" />
                    </div> -->

                    <div id="paneSwitcher" class="edgePanel"
                        style="position: absolute;left: 0px;top: 0px;display: none"></div>

                    <!-- Basemap Selector rechts unten -->
                    <div id="basemap_selector" title="Hintergrundkarte wählen" onclick="toggleBasemapWidget()">
                        <div class="basemap-preview"></div>
                        <span class="basemap-label">Hintergrund</span>
                    </div>

                    <!-- Basemap Widget -->
                    <div id="basemap_widget" class="basemap-widget-hidden">
                        <div class="basemap-widget-header">
                            <span>GRUNDKARTE</span>
                            <button class="basemap-widget-close" onclick="toggleBasemapWidget()">&times;</button>
                        </div>
                        <div class="basemap-widget-content">
                            <!-- Layer Toggles -->
                            <div class="basemap-layer-section">
                                <div class="basemap-layer-row">
                                    <span class="layer-icon">〰</span>
                                    <span class="layer-label">Höhenkurven</span>
                                    <div class="layer-toggle">
                                        <button class="toggle-btn active" data-layer="hoehenkurven" data-value="on">EIN</button>
                                        <button class="toggle-btn" data-layer="hoehenkurven" data-value="off">AUS</button>
                                    </div>
                                </div>
                                <div class="basemap-layer-row">
                                    <span class="layer-icon">⊞</span>
                                    <span class="layer-label">Projektebene</span>
                                    <div class="layer-toggle">
                                        <button class="toggle-btn" data-layer="projektebene" data-value="on">EIN</button>
                                        <button class="toggle-btn active" data-layer="projektebene" data-value="off">AUS</button>
                                    </div>
                                </div>
                                <div class="basemap-layer-row">
                                    <span class="layer-icon">◯</span>
                                    <span class="layer-label">Gemeindegrenzen</span>
                                    <div class="layer-toggle">
                                        <button class="toggle-btn active" data-layer="gemeindegrenzen" data-value="on">EIN</button>
                                        <button class="toggle-btn" data-layer="gemeindegrenzen" data-value="off">AUS</button>
                                    </div>
                                </div>
                                <div class="basemap-layer-row">
                                    <span class="layer-icon">◧</span>
                                    <span class="layer-label">Farbig / Grau</span>
                                    <div class="layer-toggle">
                                        <button class="toggle-btn active" data-layer="farbmodus" data-value="color" 
                                            onclick="njs.AppManager.toggleBaseLayerColor('main','toggle_coltool1',this); this.classList.add('active'); this.nextElementSibling.classList.remove('active');">FARBE</button>
                                        <button class="toggle-btn" data-layer="farbmodus" data-value="grey"
                                            onclick="njs.AppManager.toggleBaseLayerColor('main','toggle_coltool1',this); this.classList.add('active'); this.previousElementSibling.classList.remove('active');">GRAU</button>
                                    </div>
                                </div>
                                <div class="basemap-layer-row">
                                    <span class="layer-label">Transparenz</span>
                                    <input type="range" class="transparency-slider" min="0" max="100" value="0" 
                                        oninput="njs.AppManager.setBaseLayerOpacity('main',this.value); this.nextElementSibling.textContent=this.value;" 
                                        onchange="njs.AppManager.setBaseLayerOpacity('main',this.value);">
                                    <span class="transparency-value">0</span>
                                </div>
                            </div>

                            <!-- Haupt-Basemaps (immer sichtbar) -->
                            <div class="basemap-cards-main">
                                <div class="basemap-card active" data-basemap="swissimage" onclick="njs.AppManager.Maps['main'].changeBaseMap('swissimage');">
                                    <div class="basemap-card-preview orthofoto"></div>
                                    <span class="basemap-card-label">Orthofoto</span>
                                </div>
                                <div class="basemap-card" data-basemap="av_sw" onclick="njs.AppManager.Maps['main'].changeBaseMap('av_sw');">
                                    <div class="basemap-card-preview basisplan"></div>
                                    <span class="basemap-card-label">Basisplan</span>
                                </div>
                                <div class="basemap-card" data-basemap="plan_fuer_grundbuch_bund" onclick="njs.AppManager.Maps['main'].changeBaseMap('plan_fuer_grundbuch_bund');">
                                    <div class="basemap-card-preview grundbuch"></div>
                                    <span class="basemap-card-label">Plan f. Grundbuch</span>
                                </div>
                            </div>

                            <!-- Erweiterte Basemap Auswahl -->
                            <div class="basemap-expand-header">
                                <span class="expand-icon">▶</span> erweitern
                            </div>
                            <div class="basemap-cards">
                                <div class="basemap-card" data-basemap="pk_color" onclick="njs.AppManager.Maps['main'].changeBaseMap('pk_color');">
                                    <div class="basemap-card-preview landeskarte"></div>
                                    <span class="basemap-card-label">Landeskarte</span>
                                </div>
                                <div class="basemap-card" data-basemap="siegfried" onclick="njs.AppManager.Maps['main'].changeBaseMap('siegfried');">
                                    <div class="basemap-card-preview siegfried"></div>
                                    <span class="basemap-card-label">Siegfriedkarten</span>
                                </div>
                                <div class="basemap-card" data-basemap="none" onclick="njs.AppManager.Maps['main'].changeBaseMap('none');">
                                    <div class="basemap-card-preview transparent"></div>
                                    <span class="basemap-card-label">Transparent</span>
                                </div>
                                <div class="basemap-card" data-basemap="leer" onclick="njs.AppManager.Maps['main'].changeBaseMap('leer');">
                                    <div class="basemap-card-preview keine"></div>
                                    <span class="basemap-card-label">Leer</span>
                                </div>
                                <div class="basemap-card" data-basemap="av_color" onclick="njs.AppManager.Maps['main'].changeBaseMap('av_color');">
                                    <div class="basemap-card-preview av-color"></div>
                                    <span class="basemap-card-label">Basisplan farbig</span>
                                </div>
                                <div class="basemap-card" data-basemap="osm" onclick="njs.AppManager.Maps['main'].changeBaseMap('osm');">
                                    <div class="basemap-card-preview osm"></div>
                                    <span class="basemap-card-label">OpenStreetMap</span>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
                <!-- /map container -->


                <div dojotype="dijit.layout.ContentPane" id='custompaneContainer' class="outer"
                    style="width:440px; -webkit-overflow-scrolling:touch !important; margin: 0px;padding: 0px;border: none;"
                    data-dojo-props="region: 'right', splitter: true">
                    <iframe id="custompaneFrame" src="" height="100%"
                        style="-webkit-overflow-scrolling:touch !important; border:none; width:100%; height:100%;">
                    </iframe>
                    <iframe id="custompaneFrameForm" src="" height="100%"
                        style="-webkit-overflow-scrolling:touch !important;display:none; border:none; width:100%; height:100%;">
                    </iframe>
                    <!-- divert maptips in this area -->
                    <!-- <div id="custompaneDiv"></div> -->
                </div>
                <div dojotype="dijit.layout.ContentPane" id='streetviewContainer' class="outer"
                    style="width:500px; -webkit-overflow-scrolling:touch !important; margin: 0px;padding: 0px;border: none;"
                    data-dojo-props="region: 'right', splitter: true">
                    <iframe id="streetviewFrame" src="" height="100%"
                        style="border:0px; width:100%; height:calc(100%+1px);">
                    </iframe>
                </div>
            </div>
            <!-- /centerPaneLayout-->
        </div>
        <!-- /centerPane-->
        <!-- End EdgePannel -->
    </div>
    <!-- /NeapoljsContainer -->

    <!-- TNET------------------------->
    <!-- TNET helpers for bookmarks&Co. -->
    <script type="text/javascript" src="/maps/tnet/tnet-mapplus-helpers.js"></script>
    
    <!-- TNET Accordion/Tab-Konverter -->
    <link rel="stylesheet" href="/maps/tnet/tnet_toc.css" />
    <script type="text/javascript" src="/maps/tnet/tnet_toc.js"></script>

    <!-- Panel-Schatten dynamisch positioniert -->
    <script type="text/javascript">
        (function() {
            function initPanelShadow() {
                var freepane = document.getElementById('freepane');
                var closeSwitch = document.querySelector('.close_switch');
                if (!freepane || !closeSwitch) {
                    setTimeout(initPanelShadow, 200);
                    return;
                }
                
                // Schatten-Element erstellen
                var shadow = document.createElement('div');
                shadow.id = 'panelShadow';
                freepane.parentNode.insertBefore(shadow, freepane.nextSibling);
                
                function updateShadow() {
                    var rect = closeSwitch.getBoundingClientRect();
                    var headerTop = 69;
                    var bottom = rect.bottom;
                    var width = rect.width;
                    
                    shadow.style.top = headerTop + 'px';
                    shadow.style.height = (bottom - headerTop) + 'px';
                    shadow.style.width = width + 'px';
                    
                    // Bei geschlossenem Panel: Breite der minimierten Leiste
                    if (freepane.classList.contains('close')) {
                        shadow.style.width = '170px';
                        shadow.style.left = ((340 - 170) / 2) + 'px';
                        shadow.style.borderRadius = '0 0 4px 4px';
                    } else {
                        shadow.style.left = '0px';
                        shadow.style.borderRadius = '0 0 4px 4px';
                    }
                }
                
                // Kontinuierliche Animation mit requestAnimationFrame
                function animateLoop() {
                    updateShadow();
                    requestAnimationFrame(animateLoop);
                }
                animateLoop();
                
                window.addEventListener('resize', updateShadow);
            }
            
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initPanelShadow);
            } else {
                initPanelShadow();
            }
        })();
    </script>

    <!-- Scroll-to-Top Button Logic -->
    <script type="text/javascript">
        // Scroll-to-Top Funktionalität für #spring
        function scrollSpringToTop() {
            var spring = document.getElementById('spring');
            if (spring) {
                spring.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }
        
        // Button ein-/ausblenden basierend auf Scroll-Position
        (function() {
            function initScrollToTop() {
                var spring = document.getElementById('spring');
                var btn = document.getElementById('scrollToTopBtn');
                if (!spring || !btn) {
                    setTimeout(initScrollToTop, 500);
                    return;
                }
                
                spring.addEventListener('scroll', function() {
                    if (spring.scrollTop > 100) {
                        btn.classList.add('visible');
                    } else {
                        btn.classList.remove('visible');
                    }
                });
            }
            
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initScrollToTop);
            } else {
                initScrollToTop();
            }
        })();
    </script>

    <script type="text/javascript">
        // Auto-Start für Bookmark-URLs direkt vor </body>
        (function() {
            console.log('Auto-Start Script geladen');
            
            function startBookmarkFromUrl() {
                var currentPath = window.location.pathname;
                console.log('Prüfe URL:', currentPath);
                
                var match = currentPath.match(/\/maps\/([^\/]+)$/);
                
                if (match && match[1]) {
                    var bookmarkId = match[1];
                    console.log('Bookmark in URL gefunden:', bookmarkId);
                    
                    // Prüfe ob alle benötigten Funktionen verfügbar sind
                    if (typeof window.TnetSetBookmark === 'function' &&
                        window.njs && window.njs.AppManager && 
                        window.njs.AppManager.setMapBookmark &&
                        typeof window.njs.AppManager.infoFloatWinRemoveallItems === 'function') {
                        console.log('Alle Funktionen verfügbar - rufe TnetSetBookmark auf');
                        window.TnetSetBookmark(bookmarkId);
                    } else {
                        console.log('Warte auf vollständiges Laden... (njs.AppManager.infoFloatWinRemoveallItems)');
                        setTimeout(startBookmarkFromUrl, 1500);
                    }
                } else {
                    console.log('Keine Bookmark-ID in URL');
                }
            }
            
            // Starte nach 2 Sekunden
            setTimeout(startBookmarkFromUrl, 4000);
        })();
    </script>

    <script type="text/javascript">
        // Funktionen auf window machen damit sie global erreichbar sind
        var iframeHistory = [];
        var iframeHistoryIndex = -1;
        
        window.setupIframeMonitoring = function() {
            var iframe = document.getElementById("mapsInfoFrame");
            if (iframe) {
                iframe.addEventListener('load', function() {
                    try {
                        var currentUrl = iframe.contentWindow.location.href;
                        if (iframeHistoryIndex === -1 || iframeHistory[iframeHistoryIndex] !== currentUrl) {
                            iframeHistory = iframeHistory.slice(0, iframeHistoryIndex + 1);
                            iframeHistory.push(currentUrl);
                            iframeHistoryIndex = iframeHistory.length - 1;
                        }
                    } catch(e) {
                        console.log("Iframe URL nicht zugänglich (cross-origin)");
                    }
                });
            }
        };
        
        window.openMapsInfoDialog = function() {
            var dialog = dijit.byId("mapsInfoDialog");
            if (dialog) {
                // Toggle: Wenn Dialog offen ist, schliessen
                if (dialog.open) {
                    window.closeMapsInfoDialog();
                    return;
                }
                dialog.show();
                var iframe = document.getElementById("mapsInfoFrame");
                if (iframe) {
                    var lazySrc = iframe.getAttribute('data-src') || '/maps/tnet/inframe-maps.html';
                    if (!iframe.getAttribute('src')) {
                        iframe.src = lazySrc;
                    }
                }
                window.setupIframeMonitoring();
            }
        };
        
        window.closeMapsInfoDialog = function() {
            var dialog = dijit.byId("mapsInfoDialog");
            if (dialog) {
                dialog.hide();
                iframeHistory = [];
                iframeHistoryIndex = -1;
                var iframe = document.getElementById("mapsInfoFrame");
                if (iframe) {
                    // iframe entladen, um Ressourcen freizugeben
                    iframe.removeAttribute('src');
                }
            }
        };
        
        window.goBackInIframe = function() {
            var iframe = document.getElementById("mapsInfoFrame");
            if (!iframe) return;
            
            try {
                iframe.contentWindow.history.back();
            } catch(e) {
                if (iframeHistoryIndex > 0) {
                    iframeHistoryIndex--;
                    iframe.src = iframeHistory[iframeHistoryIndex];
                } else {
                    console.log("Keine vorherige Seite in der History");
                }
            }
        };
        
        window.refreshIframe = function() {
            var iframe = document.getElementById("mapsInfoFrame");
            if (!iframe) return;
            var baseSrc = iframe.getAttribute('data-src') || '/maps/tnet/inframe-maps.html';
            if (!iframe.getAttribute('src')) {
                iframe.src = baseSrc;
            } else {
                var newSrc = baseSrc + (baseSrc.indexOf('?') === -1 ? '?t=' : '&t=') + Date.now();
                iframe.src = newSrc;
            }
        };

        // Basemap Widget Toggle - Kachel wächst zum Widget
        window.toggleBasemapWidget = function() {
            var widget = document.getElementById('basemap_widget');
            var selector = document.getElementById('basemap_selector');
            if (widget && selector) {
                widget.classList.toggle('basemap-widget-hidden');
                selector.classList.toggle('hidden');
            }
        };

        // Login/Logout Status prüfen und anzeigen
        window.updateLoginStatus = function() {
            var loginBtn = document.getElementById('header_login');
            var logoutSection = document.getElementById('header_logout');
            var usernameEl = document.getElementById('header_username');
            
            // Prüfe ob njs.AppManager und auth_user verfügbar
            if (window.njs && njs.AppManager && njs.AppManager.auth_user && njs.AppManager.auth_user !== '') {
                var username = njs.AppManager.auth_user;
                // Angemeldet
                if (loginBtn) loginBtn.style.display = 'none';
                if (logoutSection) logoutSection.style.display = 'flex';
                if (usernameEl) usernameEl.textContent = username;
            } else {
                // Nicht angemeldet
                if (loginBtn) loginBtn.style.display = 'flex';
                if (logoutSection) logoutSection.style.display = 'none';
            }
        };

        // Logout-Funktion
        window.doLogout = function() {
            // Direkte Navigation zur logout.php
            window.location.href = 'logout.php';
        };

        // Login-Status beim Laden prüfen
        (function checkLoginStatus() {
            if (window.njs && njs.AppManager && typeof njs.AppManager.auth_user !== 'undefined') {
                updateLoginStatus();
            } else {
                setTimeout(checkLoginStatus, 500);
            }
        })();

        // Basemap Widget Interaktion
        document.addEventListener('DOMContentLoaded', function() {
            // Toggle Buttons
            document.querySelectorAll('.layer-toggle .toggle-btn').forEach(function(btn) {
                btn.addEventListener('click', function() {
                    var parent = this.closest('.layer-toggle');
                    parent.querySelectorAll('.toggle-btn').forEach(function(b) {
                        b.classList.remove('active');
                    });
                    this.classList.add('active');
                    // TODO: Hier Layer ein/ausschalten
                    console.log('Layer:', this.dataset.layer, 'Value:', this.dataset.value);
                });
            });

            // Basemap Cards - Aktiv-Status setzen
            document.querySelectorAll('.basemap-card').forEach(function(card) {
                card.addEventListener('click', function() {
                    // Alle Cards deaktivieren (auch in main und expanded)
                    document.querySelectorAll('.basemap-card').forEach(function(c) {
                        c.classList.remove('active');
                    });
                    this.classList.add('active');
                });
            });

            // Expand Header
            var expandHeader = document.querySelector('.basemap-expand-header');
            if (expandHeader) {
                expandHeader.addEventListener('click', function() {
                    var cards = document.querySelector('.basemap-cards');
                    var icon = this.querySelector('.expand-icon');
                    if (cards) {
                        cards.classList.toggle('expanded');
                        icon.textContent = cards.classList.contains('expanded') ? '▼' : '▶';
                    }
                });
            }
        });

        // FloatingPane (Maptips Dialog) unter Header positionieren
        (function() {
            var headerHeight = 69;
            var minTop = 80;
            
            function adjustPanePosition(pane) {
                if (!pane) return;
                var top = parseInt(pane.style.top) || 0;
                if (top < headerHeight) {
                    pane.style.top = minTop + 'px';
                }
            }
            
            // Observer für das ganze Dokument - fängt neue Elemente ab
            var bodyObserver = new MutationObserver(function(mutations) {
                mutations.forEach(function(mutation) {
                    if (mutation.type === 'childList') {
                        mutation.addedNodes.forEach(function(node) {
                            if (node.nodeType === 1 && node.classList && 
                                node.classList.contains('dojoxFloatingPane')) {
                                adjustPanePosition(node);
                                // Observer für Style-Änderungen auf diesem Pane
                                var styleObserver = new MutationObserver(function() {
                                    adjustPanePosition(node);
                                });
                                styleObserver.observe(node, { attributes: true, attributeFilter: ['style'] });
                            }
                        });
                    }
                });
            });
            bodyObserver.observe(document.body, { childList: true, subtree: true });
            
            // Bestehende Panes auch behandeln
            document.querySelectorAll('.dojoxFloatingPane').forEach(function(pane) {
                adjustPanePosition(pane);
                var styleObserver = new MutationObserver(function() {
                    adjustPanePosition(pane);
                });
                styleObserver.observe(pane, { attributes: true, attributeFilter: ['style'] });
            });
        })();

        // Preload des iFrames bei erster Nutzerinteraktion
        (function(){
            var preloaded = false;
            function preloadMapsInfoIframe(){
                if (preloaded) return;
                var iframe = document.getElementById('mapsInfoFrame');
                if (!iframe) return;
                var lazySrc = iframe.getAttribute('data-src') || '/maps/tnet/inframe-maps.html';
                if (!iframe.getAttribute('src')) {
                    iframe.src = lazySrc;
                }
                preloaded = true;
            }
            var opts = { once: true, passive: true };
            document.addEventListener('pointerdown', preloadMapsInfoIframe, opts);
            document.addEventListener('keydown', preloadMapsInfoIframe, opts);
            document.addEventListener('touchstart', preloadMapsInfoIframe, opts);
            document.addEventListener('mouseover', preloadMapsInfoIframe, opts);
        })();
    </script>


</body>

</html>